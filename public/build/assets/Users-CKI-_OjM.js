import{r as p,j as e,y as w,T as u,D as F,W as f,B as h,H as G,J as Z,K as ee,L,M as i,O as re,$ as V,a0 as g,ap as se,Q as oe,I as A,R as S,S as k,U as W,a6 as R,V as T,X as $,ak as ne}from"./vendor-mui-core-DBd5ZEVJ.js";import{H as ae,r as v}from"./vendor-inertia-DG3k1AW_.js";import{S as le}from"./layouts-CWvtt3F_.js";import{S as te,u as ie,w as de,e as ce,x as B,V as M}from"./vendor-mui-icons-CJ3FWITC.js";import"./vendor-react-zq6P3Ky3.js";import"./components-BPSCg1q0.js";import"./pages-profile-Drl2W6-d.js";function je({users:z=[]}){const[D,N]=p.useState(""),[b,C]=p.useState({open:!1,user:null}),[d,y]=p.useState({open:!1,user:null,newRole:null}),[n,c]=p.useState({open:!1,user:null,password:"",confirmPassword:"",error:""}),[s,a]=p.useState({open:!1,name:"",email:"",password:"",confirmPassword:"",role:"Author",error:"",showPassword:!1,showConfirmPassword:!1}),[x,t]=p.useState(null),[j,m]=p.useState({open:!1,message:"",severity:"success"}),q=(r,o)=>{const l=r.role||"Author";o==="Admin"||l==="Admin"&&o!=="Admin"?y({open:!0,user:r,newRole:o}):U(r.id,o,r.name)},U=(r,o,l)=>{t(r),v.patch(route("admin.users.updateRole",r),{role:o},{preserveScroll:!0,preserveState:!1,onSuccess:()=>{t(null),m({open:!0,message:`Successfully updated ${l}'s role to ${o}`,severity:"success"})},onError:()=>{t(null),m({open:!0,message:"Failed to update role. Please try again.",severity:"error"})}})},H=()=>{d.user&&(U(d.user.id,d.newRole,d.user.name),y({open:!1,user:null,newRole:null}))},O=r=>{C({open:!0,user:r})},J=()=>{b.user&&v.delete(route("admin.users.delete",b.user.id),{preserveScroll:!0,onSuccess:()=>{C({open:!1,user:null})}})},K=r=>{c({open:!0,user:r,password:"",confirmPassword:"",error:""})},Q=()=>{const{user:r,password:o,confirmPassword:l}=n;if(!o||o.length<8){c({...n,error:"Password must be at least 8 characters"});return}if(o!==l){c({...n,error:"Passwords do not match"});return}t(r.id),v.patch(route("admin.users.updatePassword",r.id),{password:o},{preserveScroll:!0,onSuccess:()=>{t(null),c({open:!1,user:null,password:"",confirmPassword:"",error:""}),m({open:!0,message:`Successfully updated password for ${r.name}`,severity:"success"})},onError:P=>{t(null),c({...n,error:P.password||"Failed to update password. Please try again."})}})},X=()=>{const{name:r,email:o,password:l,confirmPassword:P,role:E}=s;if(!r||!o||!l||!P||!E){a({...s,error:"All fields are required"});return}if(l.length<8){a({...s,error:"Password must be at least 8 characters"});return}if(l!==P){a({...s,error:"Passwords do not match"});return}t("creating"),v.post(route("admin.users.create"),{name:r,email:o,password:l,role:E},{preserveScroll:!0,onSuccess:()=>{t(null),a({open:!1,name:"",email:"",password:"",confirmPassword:"",role:"Author",error:""}),m({open:!0,message:`Successfully created user ${r}`,severity:"success"})},onError:_=>{t(null),a({...s,error:_.email||_.password||"Failed to create user. Please try again."})}})},Y=r=>{const o=!r.email_verified_at,l=o?"verify":"unverify";t(r.id),v.patch(route("admin.users.toggleVerification",r.id),{verify:o},{preserveScroll:!0,onSuccess:()=>{t(null),m({open:!0,message:`Successfully ${l==="verify"?"verified":"unverified"} ${r.name}'s account`,severity:"success"})},onError:()=>{t(null),m({open:!0,message:`Failed to ${l} account. Please try again.`,severity:"error"})}})},I=z.filter(r=>r.name?.toLowerCase().includes(D.toLowerCase())||r.email?.toLowerCase().includes(D.toLowerCase()));return e.jsxs(le,{children:[e.jsx(ae,{title:"User Management"}),e.jsxs(w,{sx:{p:3},children:[e.jsx(u,{variant:"h4",gutterBottom:!0,sx:{fontWeight:"bold",color:"#1abc9c",mb:3},children:"User Management"}),e.jsx(F,{elevation:0,sx:{p:2,mb:3,border:"1px solid #e0e0e0",borderRadius:2},children:e.jsx(f,{fullWidth:!0,placeholder:"Search by name or email...",value:D,onChange:r=>N(r.target.value),InputProps:{startAdornment:e.jsx(te,{sx:{mr:1,color:"text.secondary"}})}})}),e.jsxs(F,{elevation:0,sx:{p:3,border:"1px solid #e0e0e0",borderRadius:2},children:[e.jsxs(w,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(u,{variant:"h6",sx:{fontWeight:600},children:["All Users (",I.length,")"]}),e.jsx(h,{variant:"contained",startIcon:e.jsx(ie,{}),onClick:()=>a({open:!0,name:"",email:"",password:"",confirmPassword:"",role:"Author",error:""}),sx:{backgroundColor:"#1abc9c","&:hover":{backgroundColor:"#16a085"},textTransform:"none"},children:"Add User"})]}),e.jsx(G,{children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(L,{sx:{backgroundColor:"#f8f9fa"},children:[e.jsx(i,{sx:{fontWeight:600},children:"Name"}),e.jsx(i,{sx:{fontWeight:600},children:"Email"}),e.jsx(i,{sx:{fontWeight:600},children:"Role"}),e.jsx(i,{sx:{fontWeight:600},children:"Account Status"}),e.jsx(i,{sx:{fontWeight:600},children:"Registered"}),e.jsx(i,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(re,{children:I.map(r=>e.jsxs(L,{hover:!0,children:[e.jsx(i,{children:r.name}),e.jsx(i,{children:r.email}),e.jsx(i,{children:e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(V,{value:r.role||"Author",onChange:o=>q(r,o.target.value),size:"small",disabled:x===r.id,displayEmpty:!0,renderValue:o=>o?o.charAt(0).toUpperCase()+o.slice(1):"Select Role",sx:{minWidth:120,"& .MuiSelect-select":{py:1}},children:[e.jsx(g,{value:"Author",children:"Author"}),e.jsx(g,{value:"Reviewer",children:"Reviewer"}),e.jsx(g,{value:"Admin",children:"Admin"})]}),x===r.id&&e.jsx(se,{size:20})]})}),e.jsx(i,{children:e.jsx(oe,{label:r.email_verified_at?"✓ Verified":"⚠ Unverified",size:"small",onClick:()=>Y(r),sx:{bgcolor:r.email_verified_at?"#d4edda":"#fff3cd",color:r.email_verified_at?"#155724":"#856404",fontWeight:600,cursor:"pointer","&:hover":{bgcolor:r.email_verified_at?"#c3e6cb":"#ffe69c"}}})}),e.jsx(i,{children:new Date(r.created_at).toLocaleDateString("id-ID")}),e.jsx(i,{children:e.jsxs(w,{sx:{display:"flex",gap:1},children:[e.jsx(A,{onClick:()=>K(r),color:"primary",size:"small",title:"Edit Password",children:e.jsx(de,{})}),e.jsx(A,{onClick:()=>O(r),color:"error",size:"small",title:"Delete User",children:e.jsx(ce,{})})]})})]},r.id))})]})})]})]}),e.jsxs(S,{open:d.open,onClose:()=>y({open:!1,user:null,newRole:null}),maxWidth:"sm",fullWidth:!0,children:[e.jsx(k,{sx:{color:"#d32f2f",fontWeight:600},children:"⚠️ Confirm Critical Role Change"}),e.jsxs(W,{sx:{mt:2},children:[e.jsx(u,{variant:"body1",sx:{mb:2},children:"You are about to change a critical role:"}),e.jsxs(w,{sx:{p:2,bgcolor:"#fff3e0",borderRadius:1,mb:2},children:[e.jsxs(u,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"User:"})," ",d.user?.name]}),e.jsxs(u,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Current Role:"})," ",d.user?.role||"Author"]}),e.jsxs(u,{variant:"body2",children:[e.jsx("strong",{children:"New Role:"})," ",d.newRole]})]}),e.jsx(R,{severity:"warning",sx:{mb:2},children:d.newRole==="Admin"?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Warning:"})," Promoting to Administrator will grant this user full system access, including:",e.jsxs("ul",{style:{marginTop:8,marginBottom:0},children:[e.jsx("li",{children:"Ability to manage all users"}),e.jsx("li",{children:"Access to all submissions"}),e.jsx("li",{children:"Permission to assign reviewers"}),e.jsx("li",{children:"Control over payments and system settings"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Warning:"})," Demoting from Administrator will revoke all administrative privileges."]})}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"This action will take effect immediately. Are you sure you want to proceed?"})]}),e.jsxs(T,{sx:{px:3,pb:2},children:[e.jsx(h,{onClick:()=>y({open:!1,user:null,newRole:null}),sx:{textTransform:"none"},children:"Cancel"}),e.jsx(h,{onClick:H,variant:"contained",sx:{backgroundColor:"#d32f2f","&:hover":{backgroundColor:"#b71c1c"},textTransform:"none"},children:"Confirm Role Change"})]})]}),e.jsxs(S,{open:b.open,onClose:()=>C({open:!1,user:null}),children:[e.jsx(k,{children:"Confirm Delete"}),e.jsx(W,{children:e.jsxs(u,{children:["Are you sure you want to delete user ",e.jsx("strong",{children:b.user?.name}),"? This action cannot be undone."]})}),e.jsxs(T,{children:[e.jsx(h,{onClick:()=>C({open:!1,user:null}),children:"Cancel"}),e.jsx(h,{onClick:J,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsxs(S,{open:n.open,onClose:()=>c({open:!1,user:null,password:"",confirmPassword:"",error:""}),maxWidth:"sm",fullWidth:!0,children:[e.jsx(k,{sx:{fontWeight:600,color:"#1abc9c"},children:"Edit User Password"}),e.jsxs(W,{sx:{mt:2},children:[e.jsxs(u,{variant:"body2",color:"text.secondary",sx:{mb:3},children:["Changing password for: ",e.jsx("strong",{children:n.user?.name})]}),n.error&&e.jsx(R,{severity:"error",sx:{mb:2},children:n.error}),e.jsx(f,{fullWidth:!0,label:"New Password",type:"password",value:n.password,onChange:r=>c({...n,password:r.target.value,error:""}),sx:{mb:2},helperText:"Minimum 8 characters"}),e.jsx(f,{fullWidth:!0,label:"Confirm New Password",type:"password",value:n.confirmPassword,onChange:r=>c({...n,confirmPassword:r.target.value,error:""}),helperText:"Re-enter the new password"})]}),e.jsxs(T,{sx:{px:3,pb:2},children:[e.jsx(h,{onClick:()=>c({open:!1,user:null,password:"",confirmPassword:"",error:""}),sx:{textTransform:"none"},disabled:x===n.user?.id,children:"Cancel"}),e.jsx(h,{onClick:Q,variant:"contained",disabled:x===n.user?.id,sx:{backgroundColor:"#1abc9c","&:hover":{backgroundColor:"#16a085"},textTransform:"none"},children:x===n.user?.id?"Updating...":"Update Password"})]})]}),e.jsxs(S,{open:s.open,onClose:()=>a({open:!1,name:"",email:"",password:"",confirmPassword:"",role:"Author",error:""}),maxWidth:"sm",fullWidth:!0,children:[e.jsx(k,{sx:{fontWeight:600,color:"#1abc9c"},children:"Create New User"}),e.jsxs(W,{sx:{mt:2},children:[s.error&&e.jsx(R,{severity:"error",sx:{mb:2},children:s.error}),e.jsx(f,{fullWidth:!0,label:"Full Name",value:s.name,onChange:r=>a({...s,name:r.target.value,error:""}),sx:{mb:2},required:!0}),e.jsx(f,{fullWidth:!0,label:"Email",type:"email",value:s.email,onChange:r=>a({...s,email:r.target.value,error:""}),sx:{mb:2},required:!0}),e.jsx(f,{fullWidth:!0,label:"Password",type:s.showPassword?"text":"password",value:s.password,onChange:r=>a({...s,password:r.target.value,error:""}),sx:{mb:2},helperText:"Minimum 8 characters",required:!0,InputProps:{endAdornment:e.jsx($,{position:"end",children:e.jsx(A,{onClick:()=>a({...s,showPassword:!s.showPassword}),edge:"end",children:s.showPassword?e.jsx(B,{}):e.jsx(M,{})})})}}),e.jsx(f,{fullWidth:!0,label:"Confirm Password",type:s.showConfirmPassword?"text":"password",value:s.confirmPassword,onChange:r=>a({...s,confirmPassword:r.target.value,error:""}),sx:{mb:2},helperText:"Re-enter the password",required:!0,InputProps:{endAdornment:e.jsx($,{position:"end",children:e.jsx(A,{onClick:()=>a({...s,showConfirmPassword:!s.showConfirmPassword}),edge:"end",children:s.showConfirmPassword?e.jsx(B,{}):e.jsx(M,{})})})}}),e.jsxs(V,{fullWidth:!0,value:s.role,onChange:r=>a({...s,role:r.target.value,error:""}),displayEmpty:!0,children:[e.jsx(g,{value:"Author",children:"Author"}),e.jsx(g,{value:"Reviewer",children:"Reviewer"}),e.jsx(g,{value:"Admin",children:"Admin"})]})]}),e.jsxs(T,{sx:{px:3,pb:2},children:[e.jsx(h,{onClick:()=>a({open:!1,name:"",email:"",password:"",confirmPassword:"",role:"Author",error:""}),sx:{textTransform:"none"},disabled:x==="creating",children:"Cancel"}),e.jsx(h,{onClick:X,variant:"contained",disabled:x==="creating",sx:{backgroundColor:"#1abc9c","&:hover":{backgroundColor:"#16a085"},textTransform:"none"},children:x==="creating"?"Creating...":"Create User"})]})]}),e.jsx(ne,{open:j.open,autoHideDuration:4e3,onClose:()=>m({...j,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(R,{onClose:()=>m({...j,open:!1}),severity:j.severity,variant:"filled",sx:{width:"100%"},children:j.message})})]})}export{je as default};
